# Deployment Guide

–≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç –≤–∫–ª—é—á–∞–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–∫—Ä–∏–ø—Ç–æ–≤ –¥–ª—è –¥–µ–ø–ª–æ—è –±–æ—Ç–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä.

## –°–∫—Ä–∏–ø—Ç—ã –¥–µ–ø–ª–æ—è

### 1. `deploy.sh` - –ü–æ–ª–Ω—ã–π –¥–µ–ø–ª–æ–π (–ø–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞)

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –ø–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–µ—Ä–≤–µ—Ä–∞ –∏ –ø–æ–ª–Ω–æ–≥–æ –¥–µ–ø–ª–æ—è:
- –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç Docker –∏ Docker Compose (–µ—Å–ª–∏ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã)
- –ö–æ–ø–∏—Ä—É–µ—Ç –≤—Å–µ —Ñ–∞–π–ª—ã
- –°–æ–±–∏—Ä–∞–µ—Ç Docker –æ–±—Ä–∞–∑—ã
- –ó–∞–ø—É—Å–∫–∞–µ—Ç —Å–µ—Ä–≤–∏—Å—ã

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
```bash
./deploy.sh root@84.35.184.210
```

### 2. `auto_deploy.sh` - –ë—ã—Å—Ç—Ä—ã–π –¥–µ–ø–ª–æ–π (–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–¥–∞)

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–æ–¥–∞ –Ω–∞ —É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–Ω–æ–º —Å–µ—Ä–≤–µ—Ä–µ:
- –ö–æ–ø–∏—Ä—É–µ—Ç —Ç–æ–ª—å–∫–æ –∏–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
- –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –±–æ—Ç–∞ (–±–µ–∑ –ø–µ—Ä–µ—Å–±–æ—Ä–∫–∏ –æ–±—Ä–∞–∑–æ–≤)
- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å—Ç–∞—Ç—É—Å –∏ –ª–æ–≥–∏

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
```bash
# –ë–∞–∑–æ–≤–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
./auto_deploy.sh

# –° —É–∫–∞–∑–∞–Ω–∏–µ–º —Ö–æ—Å—Ç–∞
./auto_deploy.sh root@84.35.184.210

# –° –ø–µ—Ä–µ—Å–±–æ—Ä–∫–æ–π Docker –æ–±—Ä–∞–∑–æ–≤ (–µ—Å–ª–∏ –∏–∑–º–µ–Ω–∏–ª–∏—Å—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏)
./auto_deploy.sh --rebuild

# –ë–µ–∑ –ø–æ–∫–∞–∑–∞ –ª–æ–≥–æ–≤
./auto_deploy.sh --no-logs

# –ö–æ–º–±–∏–Ω–∞—Ü–∏—è –æ–ø—Ü–∏–π
./auto_deploy.sh root@84.35.184.210 --rebuild
```

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –§–∞–π–ª `deploy_config.sh`

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `deploy_config.sh` –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –¥–µ–ø–ª–æ—è:

```bash
#!/bin/bash

# Remote server connection
export DEPLOY_HOST="root@84.35.184.210"
export DEPLOY_DIR="/opt/telegram-bot"

# SSH key path (optional)
export DEPLOY_SSH_KEY="~/.ssh/selectel_key"

# Deployment options
export DEPLOY_REBUILD="false"      # –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ—Å–æ–±–∏—Ä–∞—Ç—å –æ–±—Ä–∞–∑—ã
export DEPLOY_SHOW_LOGS="true"      # –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –ª–æ–≥–∏ –ø–æ—Å–ª–µ –¥–µ–ø–ª–æ—è
```

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–í—ã —Ç–∞–∫–∂–µ –º–æ–∂–µ—Ç–µ –∑–∞–¥–∞—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:

```bash
export DEPLOY_HOST="root@84.35.184.210"
export DEPLOY_DIR="/opt/telegram-bot"
./auto_deploy.sh
```

## –¢–∏–ø–∏—á–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ü–µ—Ä–≤—ã–π –¥–µ–ø–ª–æ–π

```bash
# 1. –ü–æ–ª–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞
./deploy.sh root@84.35.184.210

# 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã
ssh -i ~/.ssh/selectel_key root@84.35.184.210 'cd /opt/telegram-bot && docker-compose logs -f bot'
```

### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–¥–∞

```bash
# –ü–æ—Å–ª–µ –≤–Ω–µ—Å–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ –∫–æ–¥
./auto_deploy.sh
```

### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å –∏–∑–º–µ–Ω–µ–Ω–∏–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

–ï—Å–ª–∏ –≤—ã –∏–∑–º–µ–Ω–∏–ª–∏ `requirements.txt` –∏–ª–∏ `Dockerfile`:

```bash
./auto_deploy.sh --rebuild
```

### –ë—ã—Å—Ç—Ä–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–µ–∑ –ª–æ–≥–æ–≤

```bash
./auto_deploy.sh --no-logs
```

## –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤

### –ë—ã—Å—Ç—Ä—ã–π —Å–ø–æ—Å–æ–± (–∏—Å–ø–æ–ª—å–∑—É—è —Å–∫—Ä–∏–ø—Ç)

```bash
# –ü–æ—Å–ª–µ–¥–Ω–∏–µ 50 —Å—Ç—Ä–æ–∫ –ª–æ–≥–æ–≤
./view_logs.sh

# –ü–æ—Å–ª–µ–¥–Ω–∏–µ 100 —Å—Ç—Ä–æ–∫
./view_logs.sh --tail=100

# –°–ª–µ–¥–∏—Ç—å –∑–∞ –ª–æ–≥–∞–º–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏ (–∫–∞–∫ tail -f)
./view_logs.sh --follow

# –° —É–∫–∞–∑–∞–Ω–∏–µ–º —Ö–æ—Å—Ç–∞
./view_logs.sh root@84.38.182.210 --follow
```

### –ü—Ä—è–º—ã–µ –∫–æ–º–∞–Ω–¥—ã SSH

```bash
# –õ–æ–≥–∏ –±–æ—Ç–∞ (–ø–æ—Å–ª–µ–¥–Ω–∏–µ 50 —Å—Ç—Ä–æ–∫)
ssh -i ~/.ssh/selectel_key root@84.35.184.210 'cd /opt/telegram-bot && docker-compose logs --tail=50 bot'

# –°–ª–µ–¥–∏—Ç—å –∑–∞ –ª–æ–≥–∞–º–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
ssh -i ~/.ssh/selectel_key root@84.35.184.210 'cd /opt/telegram-bot && docker-compose logs -f bot'

# –í—Å–µ –ª–æ–≥–∏ (–±–æ—Ç + –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö)
ssh -i ~/.ssh/selectel_key root@84.35.184.210 'cd /opt/telegram-bot && docker-compose logs -f'

# –õ–æ–≥–∏ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–π —á–∞—Å
ssh -i ~/.ssh/selectel_key root@84.35.184.210 'cd /opt/telegram-bot && docker-compose logs --since 1h bot'

# –õ–æ–≥–∏ —Å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π (—Ç–æ–ª—å–∫–æ –æ—à–∏–±–∫–∏)
ssh -i ~/.ssh/selectel_key root@84.35.184.210 'cd /opt/telegram-bot && docker-compose logs bot | grep -i error'
```

## –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–∞–º–∏

```bash
# –°—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–∏—Å–æ–≤
ssh -i ~/.ssh/selectel_key root@84.35.184.210 'cd /opt/telegram-bot && docker-compose ps'

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –±–æ—Ç–∞
ssh -i ~/.ssh/selectel_key root@84.35.184.210 'cd /opt/telegram-bot && docker-compose restart bot'

# –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –±–æ—Ç–∞
ssh -i ~/.ssh/selectel_key root@84.35.184.210 'cd /opt/telegram-bot && docker-compose stop bot'

# –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞
ssh -i ~/.ssh/selectel_key root@84.35.184.210 'cd /opt/telegram-bot && docker-compose start bot'

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
ssh -i ~/.ssh/selectel_key root@84.35.184.210 'cd /opt/telegram-bot && docker-compose restart'
```

### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ .env —Ñ–∞–π–ª–∞

```bash
# –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ .env –Ω–∞ —Å–µ—Ä–≤–µ—Ä
scp -i ~/.ssh/selectel_key .env root@84.35.184.210:/opt/telegram-bot/.env

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –ø–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è .env
ssh -i ~/.ssh/selectel_key root@84.35.184.210 'cd /opt/telegram-bot && docker-compose restart bot'
```

## –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è

### Git Hook –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –¥–µ–ø–ª–æ—è

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.git/hooks/post-commit`:

```bash
#!/bin/bash
# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –¥–µ–ø–ª–æ–π –ø–æ—Å–ª–µ –∫–æ–º–º–∏—Ç–∞ –≤ main –≤–µ—Ç–∫—É
BRANCH=$(git rev-parse --abbrev-ref HEAD)
if [ "$BRANCH" = "main" ]; then
    echo "üöÄ Auto-deploying to server..."
    ./auto_deploy.sh
fi
```

–°–¥–µ–ª–∞–π—Ç–µ –µ–≥–æ –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–º:
```bash
chmod +x .git/hooks/post-commit
```

### Alias –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞

–î–æ–±–∞–≤—å—Ç–µ –≤ `~/.bashrc` –∏–ª–∏ `~/.zshrc`:

```bash
alias deploy='cd /path/to/project && ./auto_deploy.sh'
alias deploy-rebuild='cd /path/to/project && ./auto_deploy.sh --rebuild'
```

## –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –ø–æ SSH

–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ:
- SSH –∫–ª—é—á –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ `~/.ssh/selectel_key`
- –ü—Ä–∞–≤–∞ –Ω–∞ –∫–ª—é—á: `chmod 600 ~/.ssh/selectel_key`
- –°–µ—Ä–≤–µ—Ä –¥–æ—Å—Ç—É–ø–µ–Ω: `ssh -i ~/.ssh/selectel_key root@84.35.184.210`

### –û—à–∏–±–∫–∞ –ø—Ä–∏ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–∏ —Ñ–∞–π–ª–æ–≤

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ:
- –î–æ—Å—Ç—É–ø –∫ —Å–µ—Ä–≤–µ—Ä—É
- –ü—Ä–∞–≤–∞ –Ω–∞ –∑–∞–ø–∏—Å—å –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é `/opt/telegram-bot`
- –ù–∞–ª–∏—á–∏–µ `rsync` –Ω–∞ –ª–æ–∫–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω–µ

### –ë–æ—Ç –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ –¥–µ–ø–ª–æ—è

```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏
ssh -i ~/.ssh/selectel_key root@84.35.184.210 'cd /opt/telegram-bot && docker-compose logs bot'

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å
ssh -i ~/.ssh/selectel_key root@84.35.184.210 'cd /opt/telegram-bot && docker-compose ps'

# –ü–µ—Ä–µ—Å–æ–±–µ—Ä–∏—Ç–µ –æ–±—Ä–∞–∑—ã
./auto_deploy.sh --rebuild
```

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

‚ö†Ô∏è **–í–∞–∂–Ω–æ:**
- –ù–µ –∫–æ–º–º–∏—Ç—å—Ç–µ —Ñ–∞–π–ª `.env` –≤ Git
- –•—Ä–∞–Ω–∏—Ç–µ SSH –∫–ª—é—á–∏ –≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ–º –º–µ—Å—Ç–µ
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–∏–ª—å–Ω—ã–µ –ø–∞—Ä–æ–ª–∏ –¥–ª—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
- –†–µ–≥—É–ª—è—Ä–Ω–æ –æ–±–Ω–æ–≤–ª—è–π—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

